<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Bancário - Visualizar Dados</title>
    
    <link rel="stylesheet" href="estilo.css"> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.5.1/plotly.min.js"></script>
</head>
<body>
    <header class="centropag">
        <h1>Dados Bancários</h1>
    </header>
    <nav class="navfooter">
        <a href="pagemconst.html">Tutorial</a>
        <a href="pagemconst.html">Início</a>
        <a href="pagemconst.html">Suporte</a>
    </nav>
    <hr>
    <div class="centropag">
        <article>
            <section>
                <h3>Carregamento dos Dados Bancários -</h3>
            </section>
            <section>
                <p>Selecione o arquivo "CSV" a ser visualizado: </p>
                <input type="file" id="csvFileInput" accept=".csv">
            </section>
        </article>
    </div>
    <br>
    <div class="centropag">
        <article>
            <section>
                <h3>Visualização dos Dados -</h3>
                <div id="dataPreview" class="table"></div>
            </section>
        </article>
    </div>
    <br>
    <div class="centropag">
        <article>
            <section>
                <h3>Amostra dos Dados em Gráficos -</h3>
                <select id="chartType">
                    <option value="line">Gráfico de Linhas</option>
                    <option value="bar">Gráfico de Barras</option>
                    <option value="pie">Gráfico de Pizza</option>
                  </select>
                  <button id="generateChart">Gerar Gráfico</button>
                  <div id="chart"></div>
            </section>
            <section>
                <p>Exportar o Gráfico: </p>
                <button id="saveChart">Salvar Gráfico</button>
            </section>
        </article>
    </div>
    <hr>
    <footer class="navfooter">
        <a href="pagemconst.html">Contato</a>
        <a href="pagemconst.html">Redes Sociais</a>
        <a href="pagemconst.html">Sobre</a>
    </footer>

    <script>
        let chartData = null;
    
        function loadCSV(file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            const csvData = e.target.result;
            processData(csvData);
          };
          reader.readAsText(file);
        }
    
        function processData(csvData) {
          const lines = csvData.split('\n');
          const headers = lines[0].split(',');
          const data = [];
    
          for (let i = 1; i < lines.length; i++) {
            const values = lines[i].split(',');
            if (values.length === headers.length) {
              const entry = {};
              for (let j = 0; j < headers.length; j++) {
                entry[headers[j]] = values[j];
              }
              data.push(entry);
            }
          }
    
          chartData = data;
          displayPreview(data);
        }
    
        function displayPreview(data) {
          const table = document.createElement('table');
          const headers = Object.keys(data[0]);
    
          let tableHTML = '<thead><tr>';
          for (const header of headers) {
            tableHTML += `<th>${header}</th>`;
          }
          tableHTML += '</tr></thead>';
    
          tableHTML += '<tbody>';
          for (const entry of data) {
            tableHTML += '<tr>';
            for (const header of headers) {
              tableHTML += `<td>${entry[header]}</td>`;
            }
            tableHTML += '</tr>';
          }
          tableHTML += '</tbody>';
    
          table.innerHTML = tableHTML;
          document.getElementById('dataPreview').innerHTML = '';
          document.getElementById('dataPreview').appendChild(table);
        }
    
        function generateChart() {
          const selectedChartType = document.getElementById('chartType').value;
          const chartContainer = document.getElementById('chart');
          const chartWidth = 550;
          const chartHeight = 350;
    
          let chartConfig = null;
    
          if (selectedChartType === 'line') {
            chartConfig = {
              x: chartData.map(entry => entry.Date),
              y: chartData.map(entry => entry.Value),
              type: 'scatter',
            };
          } else if (selectedChartType === 'bar') {
            chartConfig = {
              x: chartData.map(entry => entry.Date),
              y: chartData.map(entry => entry.Value),
              type: 'bar',
            };
          } else if (selectedChartType === 'pie') {
            chartConfig = {
              labels: chartData.map(entry => entry.Date),
              values: chartData.map(entry => entry.Value),
              type: 'pie',
            };
          }
    
          const layout = {
            width: chartWidth,
            height: chartHeight,
          };
    
          Plotly.newPlot(chartContainer, [chartConfig], layout);
        }
    
        function saveChart() {
          const chartContainer = document.getElementById('chart');
          const downloadLink = document.createElement('a');
          downloadLink.href = chartContainer.toDataURL('image/png');
          downloadLink.download = 'chart.png';
          downloadLink.click();
        }
    
        document.getElementById('csvFileInput').addEventListener('change', function () {
          loadCSV(this.files[0]);
        });
    
        document.getElementById('generateChart').addEventListener('click', generateChart);
        document.getElementById('saveChart').addEventListener('click', saveChart);
      </script>
</body>
</html>